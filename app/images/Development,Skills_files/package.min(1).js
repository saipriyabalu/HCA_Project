!function(e){function t(e,t){return e.w('<div id="flows-view" class="oj-flex bots-container bots-helper-overflow-auto">').p("bots/flows/flow.tabs",t,t,{}).w('<div id="flows-dialog-dock" class="suite-helper-hidden"data-bind="nobind">').p("bots/flows/new.flow.dialog",t,t,{}).p("bots/flows/rename.flow.dialog",t,t,{}).p("bots/flows/delete.flow.dialog",t,t,{}).p("bots/flows/component.popup",t,t,{popupId:"component-template-popup"}).w("</div></div>")}return e.register("bots/flows/body",t),t.__dustBody=!0,t}(dust),function(e){function t(e,t){return e.w('<div class="oj-flex-bar oj-sm-align-items-center bots-helper-max-width header-row"><div class="oj-flex-bar-start title">').h("i18n",t,{},{key:"flows.selectComponentType"},"h").w("</div><div class=\"oj-flex-bar-end\"><button class=\"bots-no-margin\"data-bind=\"ojComponent: { component: 'ojButton',chroming: 'half',display: 'icons',icons: {start: 'bots-svgsprite-func-icon'},label: $root.i18n.translate('general.close') },inlinesvg: { width: 16, height: 16, project: 'bots', basename: 'func_close_16' },click: close\"></button></div></div><div class=\"oj-flex oj-sm-flex-items-initial\"><!-- ko foreach: categories --><div class=\"oj-flex-item bots-helper-tc filter-type-container\" tabindex=\"0\"data-bind=\"css: { 'bots-first-focusable': ko.unwrap($index) === 0 },click: $parent.selectCategory,enterKey\"><div data-bind=\"attr: {class: 'oj-flex bots-col-center filter-icon'}\"><div data-bind=\"attr: {class: 'bots-col-center svgsprite-icon bots-svgsprite-' + id + '_48_qual bots-svgsprite-' + id + '_48_qual-dims'}\"></div></div><div class=\"oj-flex oj-sm-justify-content-center bots-helper-margin-top-10 filter-type\"><span data-bind=\"text: displayName\"></div></div><!-- /ko --></div>")}return e.register("bots/flows/component.home",t),t.__dustBody=!0,t}(dust),function(e){function t(e,t){return e.w('<div id="').f(t.get(["popupId"],!1),t,"h").w("\" data-bind=\"ojComponent: {component: 'ojPopup',tail: 'simple',modality: 'modal',position: {at: { horizontal: 'center', vertical: 'bottom' },my: { horizontal: 'start', vertical: 'top' },collision: 'flipfit'},initialFocus: 'firstFocusable',rootAttributes: {class: 'component-template-popup suite-context-header-overlay'}}\"><div id=\"").f(t.get(["popupId"],!1),t,"h").w('-subcontent" class="oj-popup-content"></div></div>')}return e.register("bots/flows/component.popup",t),t.__dustBody=!0,t}(dust),function(e){function t(e,t){return e.w('<div class="oj-flex bots-helper-max-width"><div class="oj-flex-item list-pane"><div class="oj-flex oj-sm-align-items-center header-row"><div class="return-home"><button tabindex="0"data-bind="ojComponent: { component: \'ojButton\',chroming: \'half\',display: \'icons\',icons: { start: \'bots-svgsprite-func-icon oj-flex\',end: \'bots-helper-margin-right-0\' },label: $root.i18n.translate(\'flows.goBack\'),rootAttributes: { class: \'bots-no-margin\' } },inlinesvg: { width: 24, height: 24, project: \'bots\', basename: \'func_leftarrow_24\' },click: returnHome"></button></div><div class="title" data-bind="text: selectedCategory().displayName"></div></div><div class="list-container"><div data-bind="ojComponent: { component: \'ojNavigationList\',drillMode: \'none\',data: templates,selection: selectedTemplate,optionChange: selectTemplate,item: { template: \'component-template-list-item\' },rootAttributes: { class: \'bots-first-focusable\' } }"></div><script type="text/html" id="component-template-list-item"><li><a href="#" data-bind="text: displayName"></a></li></script></div></div><div class="oj-flex-item details-pane"><div class="oj-flex oj-sm-align-items-center header-row"><div class="oj-flex-bar-start title" data-bind="text: $root.i18n.translate(\'flows.componentTemplate\')"></div><div class="oj-flex-bar-end"><button class="bots-no-margin"data-bind="ojComponent: { component: \'ojButton\',chroming: \'half\',display: \'icons\',icons: { start: \'bots-svgsprite-func-icon\' },label: $root.i18n.translate(\'general.close\') },inlinesvg: { width: 16, height: 16, project: \'bots\', basename: \'func_close_16\' },click: close"></button></div></div><textarea rows="15"data-bind="ojComponent: { component: \'ojTextArea\',value: selectedTemplateText,attr: { id: \'templateEditor\' },rootAttributes: { class: \'bots-helper-max-width template-editor\' } }"></textarea></div><div class="footer-row oj-flex-bar"><div class="oj-flex-bar-start"><!-- ko if: states().length>0 --><label class="oj-label-inline" for="component-template-insert-after">').h("i18n",t,{},{key:"flows.insertAfter"},"h").w('</label><select id="component-template-insert-after"data-bind="ojComponent: { component: \'ojSelect\',value: insertAfter,options: states,rootAttributes: { class: \'suite-helper-margin-top-3 suite-helper-margin-right-15 insert-after\' } }"></select><!-- /ko --><label class="oj-label-inline" id="removeComm" for="component-template-remove-comments">').h("i18n",t,{},{key:"flows.removeComments"},"h").w("</label><input id=\"component-template-remove-comments\"data-bind=\"ojComponent: { component: 'ojSwitch',value: removeComments }\"/></div><div class=\"oj-flex-bar-end\"><button class=\"green-button apply-button suite-helper-margin-left-10\"data-bind=\"ojComponent: { component: 'ojButton',disabled: selectedTemplateText() === '',label: $root.i18n.translate('general.apply'),rootAttributes: { class: 'bots-no-margin' } },click: addComponentTemplate\"></button></div></div></div>")}return e.register("bots/flows/component.template",t),t.__dustBody=!0,t}(dust),function(e){function t(e,t){return t=t.shiftBlocks(s),e.p("bots/common/dialog/gray.dialog",t,t,{grayDialogId:"flows-delete-dialog",sizeKlazz:"flows-delete-dialog",actionHandler:"deleteFlow"})}function o(e,t){return t=t.shiftBlocks(s),e.h("i18n",t,{},{key:"flows.deleteFlowDialog.titleLabel"},"h")}function i(e,t){return t=t.shiftBlocks(s),e.w("<span data-bind=\"text: $root.i18n.translate('flows.deleteFlowDialog.confirmQuestion', flowName())\"></span>")}function n(e,t){return t=t.shiftBlocks(s),e.w("'").h("i18n",t,{},{key:"flows.deleteFlowDialog.deleteLabel",filter:"j"},"h").w("'")}e.register("bots/flows/delete.flow.dialog",t);var s={titleLabel:o,bodyHtml:i,actionButtonLabel:n};return t.__dustBody=!0,o.__dustBody=!0,i.__dustBody=!0,n.__dustBody=!0,t}(dust),function(e){function t(e,t){return e.w('<div class="suite-helper-max-width"><div class="oj-flex-bar flows-flow-tabs-options-row"><div class="oj-flex-bar-start"data-bind="visible: $root.permissions().BOTS_WRITE"><button id="select-component-button" class="suite-helper-margin-top-3 suite-helper-margin-left-3 green-button"data-bind="click: $root.openComponentTemplatePopup,ojComponent: { component: \'ojButton\',icons: { start: \'suite-svgsprite-cta-icon\' },label: $root.i18n.translate(\'flows.selectComponentLabel\'),disabled: !$root.isDraftVersion()},inlinesvg: { width: 16, height: 16, project: \'bots\', basename: \'func_plus_16\' }"></button><a href="#" class="suite-helper-margin-left-10 oj-sm-align-self-center"data-bind="botsHelpPopup: { unikey: $root.isDraftVersion() ? \'flows.selectComponentHelp\' : \'flows.selectComponentDisabledHelp\',my: { horizontal: \'start\', vertical: \'top\' },at: { horizontal: \'end\', vertical: \'bottom\' } }"></a></div><div class="oj-flex-bar-end oj-sm-align-items-center"><label class="oj-label-inline" for="flow-editor-color-theme">').h("i18n",t,{},{key:"flows.theme"},"h").w('</label><select id="flow-editor-color-theme"data-bind="ojComponent: { component: \'ojSelect\',value: $root.theme,rootAttributes: { class: \'suite-helper-margin-top-3 suite-helper-margin-right-3\',style: \'width: 200px;\'} }"><!-- ko foreach: $root.themeOptions --><option data-bind="value: value, text: label"></option><!-- /ko --></select></div></div><ul class="suite-helper-hidden flows-suppress-standard-oj-menu-items" id="flow-tabs-context-menu"data-bind="ojComponent: { component: \'ojMenu\',select: $root.performMenuAction,initialFocus: \'menu\' },lifecycleHook: { init: { callback: registerFlowTabsContextMenuListeners } }"><!-- ko foreach: flowTabsContextMenuItems --><li data-bind="attr: { menuId: id },css: { \'oj-disabled\': disabled }"><a href="#" data-bind="text: text"></a></li><!-- /ko --></ul><div id="flow-tabs" class="flows-flow-tabs"data-bind="ojComponent:{ component: \'ojTabs\',edge: \'top\',contextMenu: null,removable: false,reorderable: false,rootAttributes: { class: \'bots-custom-horiztabs bots-panel-onlytopborder bots-tab-selection-bottom-bar\'} },lifecycleHook: { init: { callback: registerFlowTabsListeners } }"><ul data-bind="foreach: flows"><li><span data-bind="attr: { id: \'flow-tab-label-\' + id() },text: name"></span></li></ul><!-- ko foreach: { data: flows, afterRender: synchFlowTab } --><div class="suite-no-padding"data-bind="attr: { id: \'flow-tab-\' + id() }"><div class="oj-form"><div class="oj-row suite-no-margin"><label class="suite-helper-offscreen"data-bind="attr: { for: \'flow-editor-\' + id() }">').h("i18n",t,{},{key:"flows.escapeFlowEditorHint"},"h").w("</label><textarea class=\"flowEditor\"data-bind=\"text: codeText,attr: { id: 'flow-editor-' + id() },suiteCodeMirror: { lazyValue: codeText,theme: $root.theme()[0],scrollbarStyle: null,gutters: [ 'errors', 'CodeMirror-linenumbers', 'CodeMirror-foldgutter' ],lineNumbers: true,foldGutter: {rangeFinder: require('codemirror').fold['yaml-metadata']},mode: 'yaml',readOnly: !($root.isDraftVersion() && $root.permissions().BOTS_WRITE),escapeToSelector: '#select-component-button',indentUnit: 2,replaceTabs: true,lineWrapping: true,maxWidth: $root.computeFlowMaxWidth.bind($data, id()),on: { changes: $root.onFlowEditorChanges,blur: $root.onFlowEditorBlur },rootAttributes: { class: 'CodeMirror-tall' } }\"></textarea></div></div></div><!-- /ko --></div></div>")}return e.register("bots/flows/flow.tabs",t),t.__dustBody=!0,t}(dust),function(e){function t(e,t){return t=t.shiftBlocks(r),e.p("bots/common/dialog/gray.dialog",t,t,{grayDialogId:"flows-create-dialog",sizeKlazz:"flows-create-dialog",artifKoVarName:"name",validators:"$root.botsValidators.botsOtherNameValidator, $root.uniqueNameValidator",actionHandler:"createFlow"})}function o(e,t){return t=t.shiftBlocks(r),e.h("i18n",t,{},{key:"flows.createFlowDialog.titleLabel"},"h")}function i(e,t){return t=t.shiftBlocks(r),e.h("i18n",t,{},{key:"flows.createFlowDialog.name.label"},"h")}function n(e,t){return t=t.shiftBlocks(r),e.w("'").h("i18n",t,{},{key:"flows.createFlowDialog.name.placeholder",filter:"j"},"h").w("'")}function s(e,t){return t=t.shiftBlocks(r),e.w("'").h("i18n",t,{},{key:"flows.createFlowDialog.name.required",filter:"j"},"h").w("'")}function a(e,t){return t=t.shiftBlocks(r),e.w("'").h("i18n",t,{},{key:"flows.createFlowDialog.createLabel",filter:"j"},"h").w("'")}e.register("bots/flows/new.flow.dialog",t);var r={titleLabel:o,artifNameLabel:i,artifPlaceholder:n,artifRequiredMessage:s,actionButtonLabel:a};return t.__dustBody=!0,o.__dustBody=!0,i.__dustBody=!0,n.__dustBody=!0,s.__dustBody=!0,a.__dustBody=!0,t}(dust),function(e){function t(e,t){return t=t.shiftBlocks(r),e.p("bots/common/dialog/gray.dialog",t,t,{grayDialogId:"flows-rename-dialog",sizeKlazz:"flows-rename-dialog",artifKoVarName:"newName",validators:"$root.botsValidators.botsOtherNameValidator, $root.uniqueNameValidator",actionHandler:"renameFlow"})}function o(e,t){return t=t.shiftBlocks(r),e.h("i18n",t,{},{key:"flows.renameFlowDialog.titleLabel"},"h")}function i(e,t){return t=t.shiftBlocks(r),e.h("i18n",t,{},{key:"flows.renameFlowDialog.newName.label"},"h")}function n(e,t){return t=t.shiftBlocks(r),e.w("'").h("i18n",t,{},{key:"flows.renameFlowDialog.newName.placeholder",filter:"j"},"h").w("'")}function s(e,t){return t=t.shiftBlocks(r),e.w("'").h("i18n",t,{},{key:"flows.renameFlowDialog.newName.required",filter:"j"},"h").w("'")}function a(e,t){return t=t.shiftBlocks(r),e.w("'").h("i18n",t,{},{key:"flows.renameFlowDialog.renameLabel",filter:"j"},"h").w("'")}e.register("bots/flows/rename.flow.dialog",t);var r={titleLabel:o,artifNameLabel:i,artifPlaceholder:n,artifRequiredMessage:s,actionButtonLabel:a};return t.__dustBody=!0,o.__dustBody=!0,i.__dustBody=!0,n.__dustBody=!0,s.__dustBody=!0,a.__dustBody=!0,t}(dust),define("bots.templates/flows",function(){}),define("bots.collection",["mcs.js.framework/class","mcs.js.framework/dataobject","ojs/ojtable","ojs/ojtable-model","ojs/ojpagingcontrol"],function(e,t){var o=function(e){this.config=$.extend(!0,{},this.config,e),this.Init()};return oj.Object.createSubclass(o,oj.TableDataSource,"bots.Collection"),_.extend(o,{EventType:oj.TableDataSource.EventType,decodeParams:function(e){for(var t={},o=(e.split("?")[1]||"").split("&"),i=0;i<o.length;i++){var n=o[i].split("=");try{t[n[0]]=decodeURIComponent(n[1])}catch(e){t[n[0]]=n[1]}}return t},encodeParams:function(e){for(var t=[],o=0;o<e.length;o++){var i=e[o];null!==i&&void 0!==i&&""!==i&&t.push(o+"="+encodeURIComponent(i))}return t.length?"?"+t.join("&"):""},getPath:function(e,t){var i={};return(t.pageSize||t.limit)&&(i.offset=t.startIndex||t.offset||0,i.limit=t.pageSize||t.limit||20),_.extend(i,_.omit(t,["limit","offset"])),e+o.encodeParams(i)}}),_.extend(o.prototype,{config:{disableFetch:!1,facade:void 0,idAttribute:"id",pageSize:20,orderBy:void 0,searchBy:void 0,filterKeyword:void 0,filterType:[],totalResults:!0,searchByThrottle:750,filterKeywordThrottle:750,filterTypeThrottle:750,dataobjectClass:void 0,extraFields:{},disableExtraFieldsFetch:!1,mode:void 0,selectors:{ojPagingControl:void 0},capabilities:{sort:null},events:{load:{name:"LOAD_X_LIST",data:{}}}},hasMore:void 0,pageSize:void 0,totalSize:void 0,startIndex:void 0,orderBy:void 0,searchBy:void 0,filterKeyword:void 0,filterType:void 0,items:void 0,compoundObjects:[],_isResetting:!1,Init:function(){o.superclass.Init.call(this),this.config.facade=this.config.facade||require("bots.facade"),this.hasMore=ko.observable(!1),this.totalSize=ko.observable(0),this.orderBy=ko.observable(this.config.orderBy),this.orderBy.extend({notify:"always"}),this.searchBy=ko.observable(this.config.searchBy),this.previousSearchBy=this.searchBy(),this.filterKeyword=ko.observable(this.config.filterKeyword),this.previousFilterKeyword=this.filterKeyword(),this.filterType=ko.observableArray(this.config.filterType),this.previousFilterType=this.filterType(),this.startIndex=ko.observable(0),this.pageSize=ko.observable(this.config.pageSize),this.items=ko.observableArray(),this.mode=this.config.mode,this.compoundObjects=[],this.size=ko.computed(_.bind(function(){return(this.items()||[]).length},this)),this.itemsRefreshedCallback=ko.unwrap(this.config.itemsRefreshedCallback),"function"!=typeof this.itemsRefreshedCallback&&(this.itemsRefreshedCallback=void 0),this.throttledSearchBy=ko.computed(this.searchBy).extend({rateLimit:this.config.searchByThrottle}),this.throttledSearchBy.subscribe(function(e){if((""!==e||(this.searchBy(void 0),void 0!==this.previousSearchBy))&&(this.previousSearchBy=e,void 0!==e)){var t=ko.unwrap(this.config.selectors.ojPagingControl);t?$(t).ojPagingControl("firstPage"):this.fetch({reset:!0})}},this),this.throttledFilterKeyword=ko.computed(this.filterKeyword).extend({rateLimit:this.config.filterKeywordThrottle}),this.throttledFilterKeyword.subscribe(function(e){if((""!==e||(this.filterKeyword(void 0),void 0!==this.previousFilterKeyword))&&(this.previousFilterKeyword=e,void 0!==e)){var t=ko.unwrap(this.config.selectors.ojPagingControl);t?$(t).ojPagingControl("firstPage"):this.fetch({reset:!0})}},this),this.throttledFilterType=ko.computed(this.filterType).extend({rateLimit:this.config.filterTypeThrottle}),this.throttledFilterType.subscribe(_.bind(function(e){if((this.previousFilterType||(e||[]).length)&&!_.isEqual(e,this.previousFilterType)){this.previousFilterType=e;var t=ko.unwrap(this.config.selectors.ojPagingControl);t?$(t).ojPagingControl("firstPage"):this.fetch({reset:!0})}},this)),this.orderBy.subscribe(_.bind(function(){this.fetch().then(_.bind(function(){this.handleEvent(o.EventType.SORT,this.orderByEvent())},this))},this)),this.extraFields={};var e=_.bind(function(){if(!this.config.disableExtraFieldsFetch){var e=ko.unwrap(this.config.selectors.ojPagingControl);e?$(e).ojPagingControl("firstPage"):this.fetch({reset:!0})}},this);for(var t in this.config.extraFields){var i=this.config.extraFields[t];this.extraFields[t]=ko.isObservable(i)?i:ko.observable(i),this.extraFields[t].subscribe(e)}this._eventHandlers=[];var n=ko.unwrap(this.config.events);for(var s in n)if("create"===s||"update"===s||"delete"===s){var a={};a[n[s].name]={data:_.bind(this.listeners[s],this)},this.config.facade.listen(a)}},findLink:function(e,t){var o=_.find(e,function(e){return e.rel===t});return o?o.href:void 0},fetch:function(e){e=e||{};var t=ko.unwrap(this.items);if(this._isResetting)return this.resolveEmptyRequest();if(void 0!==e.disableFetch&&(this.config.disableFetch=e.disableFetch,e=_.omit(e,"disableFetch")),this.config.disableFetch)return this.resolveEmptyRequest();var i={},n=this.orderByStringValue(),s=ko.unwrap(this.config.events),a=ko.unwrap(s.load),r=void 0!==e.startIndex?null===e.startIndex?0:e.startIndex:this.startIndex()||0,l=_.extend({orderBy:n,offset:r,limit:e.pageSize||this.pageSize()||this.config.pageSize,q:this.searchBy(),filterKeyword:this.filterKeyword(),filterType:this.filterType().length?this.filterType().join(","):void 0,totalResults:!!this.config.totalResults||void 0},e,a.data||{});for(var d in this.config.extraFields)l[d]=this.extraFields[d]();l=_.omit(l,"pageSize","startIndex","silent","fetchType"),i[a.name]={data:l,permission:a.permission};var c=$.Deferred();this.handleEvent(o.EventType.REQUEST,{startIndex:r});var u={promise:!0};if(this.config.facade.isVisible){var f=this.config.facade;!f.isVisible()||f.bindings&&ko.isObservable(f.bindings.isLoading)&&f.bindings.isLoading()?u.loadingSpinner=!0:u.actionSpinner=!0}return this.config.facade.notify(i,u).always(_.bind(function(i){if(i||(i={status:200,data:{hasMore:!1,items:[],links:[],limit:0,totalResults:0}}),!i.data||i.status&&(i.status<200||i.status>=300))return this.handleEvent(o.EventType.ERROR,i),e.error&&setTimeout(e.error,0),c.reject(i),this.resolveEmptyRequest();var n,s=this.findLink(i.data.links,"self");if(s){var a=s.slice(s.indexOf("?"));n=parseInt(o.decodeParams(a).offset,10)}this.hasMore(!!i.data.hasMore);var l=void 0!==e.startIndex?e.startIndex:n||0,d=[],u=[];this.totalSize(i.data.totalResults);var f;if(i.data.items)for(this.config.dataobjectClass?this.config.dataobjectClass.__static__.fromJS(i.data.items,this.items):this.items(i.data.items),this.compoundObjects.length=0,f=0;f<i.data.items.length;f++)this.compoundObjects.push(this.toSingleCompoundObject(l+f,i.data.items[f])),d.push(i.data.items[f]),u.push(i.data.items[f][this.config.idAttribute]);"loadMore"===this.mode&&r>0&&this.items([].concat(t,this.items())),this.startIndex(l);var h={data:d,keys:u,startIndex:l};c.resolve($.extend(!0,{},h)),this.itemsRefreshedCallback&&this.itemsRefreshedCallback($.extend(!0,{},h)),this.handleEvent(o.EventType.SYNC,h),e.success&&setTimeout(e.success,10),e.reset&&!this._isResetting&&(this._isResetting=!0,this.handleEvent(o.EventType.RESET,{}),this._isResetting=!1)},this)),c},setPageSize:function(e){this.pageSize(e)},at:function(e,t){var o=this.startIndex(),i=o>-1&&this.compoundObjects.length>e-o?this.compoundObjects[e-o]:null;return $.Deferred().resolve(i)},get:function(e){for(var t=this.items(),o=0;o<t.length;o++){var i=ko.unwrap(t[o]);if(i[this.config.idAttribute]===e){var n=this.toSingleCompoundObject(o,i);return $.Deferred().resolve(n)}}return $.Deferred().resolve(null)},getCapability:function(e){return this.config.capabilities[e]||null},sort:function(e){if(e&&e.key){var t=e.key;"ascending"===e.direction?t+=":asc":"descending"===e.direction&&(t+=":desc"),this.orderBy(t)}},orderByStringValue:function(){var e=this.orderBy();return Array.isArray(e)&&e.length&&(e=e[0]),e},orderByEvent:function(){var e=this.orderByStringValue().split(":"),t="none";return"asc"===e[1]?t="ascending":"desc"===e[1]&&(t="descending"),{header:e[0],direction:t}},handleEvent:function(e,t){for(var o=0;o<this._eventHandlers.length;o++){var i=this._eventHandlers[o];i.eventType===e&&i.eventHandlerFunc(t)}},on:function(e,t){if("function"==typeof t){for(var o=!1,i=0;i<this._eventHandlers.length;i++)if(this._eventHandlers[i].eventType===e&&this._eventHandlers[i].eventHandlerFunc===t){o=!0;break}o||this._eventHandlers.push({eventType:e,eventHandlerFunc:t})}},off:function(e,t){for(var o=this._eventHandlers.length-1;o>=0;o--)if(this._eventHandlers[o].eventType===e&&this._eventHandlers[o].eventHandlerFunc===t){this._eventHandlers.splice(o,1);break}},listeners:{create:function(e){var t=e.status>=200&&e.status<300||304===e.status;if(t){var i=this.items(),n=e.data||e,s=n;this.config.dataobjectClass&&(s=new this.config.dataobjectClass(s)),i.unshift(s),i.length>this.config.pageSize&&(this.length=this.config.pageSize),this.items(i),this.compoundObjects.unshift(this.toSingleCompoundObject(this.startIndex(),n)),this.compoundObjects.length>this.config.pageSize&&(this.compoundObjects.length=this.config.pageSize),this.totalSize(this.totalSize()+1),this.handleEvent(o.EventType.ADD,this.toAddRemoveChangeEventObject(this.startIndex(),n))}},update:function(e){var i=e.status>=200&&e.status<300||304===e.status;if(i){var n,s=this.items(),a=this.config.idAttribute,r=[],l=e.data||e;for(n=0;n<s.length;n++){var d,c=s[n];c instanceof t?(d=ko.isObservable(c[a])?c[a]():c[a],d===l[a]&&c.fromJS(l)):"object"==typeof c&&(d=c[a],d===l[a]&&_.extend(c,l)),r.push(c)}for(this.items(r),n=0;n<this.compoundObjects.length;n++){var u=this.compoundObjects[n];if(u.data[a]===l[a]){var f=this.startIndex()+n;this.compoundObjects[n]=this.toSingleCompoundObject(f,l),this.handleEvent(o.EventType.CHANGE,this.toAddRemoveChangeEventObject(f,l));break}}}},delete:function(e){var t=e.status>=200&&e.status<300||304===e.status;t&&this.fetch().then(_.bind(function(e){var t=this.totalSize()>0&&this.startIndex()>=0&&this.startIndex()>=this.totalSize(),o=ko.unwrap(this.config.selectors.ojPagingControl);t&&o&&_.defer(_.bind(function(){$(o).ojPagingControl("previousPage")},this))},this))}},toSingleCompoundObject:function(e,t){return{data:t,key:t[this.config.idAttribute],index:e}},toAddRemoveChangeEventObject:function(e,t){return{data:[t],keys:[t[this.config.idAttribute]],indexes:[e]}},resolveEmptyRequest:function(){return $.Deferred().resolve({data:[],keys:[],startIndex:0})}}),o}),define("bots.package.flows/model.rest",["module","bots.model.rest","bots.i18n","bots.config","bots.collection"],function(e,t,o,i,n){var s=t.__class__.extend({module:e,name:"FlowsRestModel"},{config:{stringifyObjects:!0,uriParams:{botId:function(){return i.getCurrentBot().id}}},FlowsRestModel:function(e){this._super(e)},createFlow:function(e,t){this.restPost(t,"/flows",{data:_.omit(e,"id")})},updateFlow:function(e,t){this.restPut(t,"/flows/{flowId}",{data:_.omit(e,"id"),uriParams:{flowId:e.id}})},deleteFlow:function(e,t){this.restDelete(t,"/flows/{flowId}",{data:_.omit(e,"id"),uriParams:{flowId:e.id}})},loadComponentTemplates:function(e,t){this.restGet(t,"",{url:"/botsui/19.1.5-1907122019/mock/json/componentTemplates.json"})}});return new s(_.extend({},t.config,{baseUrl:t.config.baseUrl+"/bots/{botId}"}))}),define("bots.package.flows/model",["module","mcs.js.framework/model.util","bots.model.rest","bots.package.flows/model.rest","bots.i18n","bots.config"],function(e,t,o,i,n,s){var a=i.__class__.extend({module:e,name:"FakeFlowsRestModel"},{config:{stringifyObjects:!0,uriParams:{botId:function(){return s.getCurrentBot().id}}},FakeFlowsRestModel:function(e){this._super(e)},createFlow:function(e,t){var o=this;_.delay(function(){var i={id:_.guid(),isMain:e.isMain||!1,name:e.name,codeLines:e.codeLines||[]};o.getFakeBotAssets("flows").push(i),t({status:201,data:i})},this.__static__.artificialDelay)},updateFlow:function(e,t){var o=this;_.delay(function(){var i=e.id,n=_.findIndex(o.getFakeBotAssets("flows"),function(e){return e.id===i});n>-1&&(o.getFakeBotAssets("flows")[n]=e),t({status:n>-1?204:404})},this.__static__.artificialDelay)},deleteFlow:function(e,t){var o=this;_.delay(function(){var i=e.id,n=_.findIndex(o.getFakeBotAssets("flows"),function(e){return e.id===i});n>-1&&o.getFakeBotAssets("flows").splice(n,1),t({status:n>-1?204:404})},this.__static__.artificialDelay)},loadComponentTemplates:function(e,t){this.restGet(t,"",{url:"/botsui/19.1.5-1907122019/mock/json/componentTemplates.json"})}},t.stubProxy);return new a(_.extend({},o.config,{baseUrl:o.config.baseUrl+"/bots/{botId}"}))}),define("bots.package.flows/facade",["module","bots.facade","bots.package.flows/model"],function(e,t,o){var i=t.__class__.extend({module:e,name:"Facade"},{__static__:{globalChannels:{}},Facade:function(){this._super();this.register({CREATE_FLOW:{name:"flows.create.flow",handler:function(e){o.createFlow(e.data,_.bind(function(t){e.data=t,this.publish(e)},this))}},UPDATE_FLOW:{name:"flows.update.flow",handler:function(e){var t=e.data.id;o.updateFlow(e.data,_.bind(function(o){e.data=_.extend(o,{id:t}),this.publish(e)},this))}},DELETE_FLOW:{name:"flows.delete.flow",handler:function(e){var t=e.data.id;o.deleteFlow(e.data,_.bind(function(o){e.data=_.extend(o,{id:t}),this.publish(e)},this))}},LOAD_COMPONENT_TEMPLATES:{name:"flows.load.component.templates",handler:function(e){o.loadComponentTemplates(e.data,_.bind(function(t){e.data=t,this.publish(e)},this))}}})}});return new i}),define("bots.package.flows/router",["module","bots.router","bots.package.defectviewer/view"],function(e,t,o,i){var n=t.__class__.extend({module:e,name:"Router"},{__static__:{baseRoute:"flows",routes:{},routeEvents:{flows:{route:"flows",dom:"#bot-details-tab-flows",template:"bots/flows/body",container:"#bot-details-tab-flows"}}},Router:function(e){this._super(e)}});return new n}),define("bots.package.flows/dataobject",["module","bots.i18n","mcs.js.framework/dataobject"],function(e,t,o){var i=o.extend({module:e,name:"FlowDetailedDO"},{__static__:{key:"id"},FlowDetailedDO:function(e){this.isMain=ko.observable(!1),this.id=ko.observable(),this.name=ko.observable(),this.codeLines=ko.observableArray([void 0]),this.codeText=ko.observable(null),this._super(e)},fromJS:function(e,t){this._super(e,t);var o=this.codeLines();!o||0!==o.length&&void 0===o[0]||this.codeText(o.join("\n"))},toJS:function(){var e=this._super();return null===e.codeText?delete e.codeLines:e.codeLines="string"==typeof e.codeText&&e.codeText.trim().length>0?e.codeText.split("\n"):[],delete e.codeText,e},reloadFromJS:function(e){var t=new i(e);this.isMain(t.isMain()),this.id(t.id()),this.name(t.name()),this.codeLines(t.codeLines()),this.codeText(t.codeText())}}),n=o.extend({module:e,name:"FlowSummaryDO"},{__static__:{key:"id"},FlowSummaryDO:function(e){this.id=ko.observable(),this.name=ko.observable(),this.isMain=ko.observable(),this._super(e)}}),s=o.extend({module:e,name:"BotFlowsDO"},{__static__:{key:"id",mapping:{items:i}},BotFlowsDO:function(e){this.items=ko.observableArray([]),this._super(e)}});return{FlowDetailedDO:i,FlowSummaryDO:n,BotFlowsDO:s}}),define("bots.package.flows/new.flow",["module","bots.package.shell/validators","bots.package.view/dialog","bots.i18n"],function(e,t,o,i){var n,s=o.extend({module:e,name:"NewFlowPopup"},{config:{type:"ojDialog"},bindings:{botsValidators:t,name:{func:ko.observable},platformVersion:{func:ko.observable,args:["1.0"]},uniqueNameValidator:{func:function(){var e=this;return{validate:function(t,o){if(!e.config.parentView.validateFlowName(t))throw new oj.ValidatorError(i.translate("flows.createFlowDialog.name.alreadyExists.summary"),i.translate("flows.createFlowDialog.name.alreadyExists.detail"))}}}},createFlow:function(){this.deps.uiComponents.validateFields($(this.config.baseElement))&&(this.enableDefaultButton(!1),this._createFlow())}},NewFlowPopup:function(e){this._super(e)},open:function(){return this._super(),n=$.Deferred()},_createFlow:function(){this.notify({CREATE_FLOW:{data:{name:this.bindings.name(),isMain:!1,codeLines:["metadata:",'  platformVersion: "'+this.bindings.platformVersion()+'"',"main: false",'name: "'+this.bindings.name()+'"']}}},{actionSpinner:!0,autoSave:"flows.flow.createFlowProgress"}).always(_.bind(function(e){this.resetFields(),this.bindings.name(""),this.close(),e.status>201?(this.deps.messaging.showI18nError(e,"flows.flow.errors.createFlow"),n.reject(e)):n.resolve(e),n=void 0},this))}});return s}),define("bots.package.flows/rename.flow",["module","bots.package.shell/validators","bots.package.view/dialog","bots.i18n"],function(e,t,o,i){var n,s=o.extend({module:e,name:"RenameFlowPopup"},{config:{type:"ojDialog"},bindings:{botsValidators:t,newName:{func:ko.observable},uniqueNameValidator:{func:function(){var e=this;return{validate:function(t,o){if(!e.config.parentView.validateFlowName(t))throw new oj.ValidatorError(i.translate("flows.renameFlowDialog.newName.alreadyExists.summary"),i.translate("flows.renameFlowDialog.newName.alreadyExists.detail"))}}}},renameFlow:function(){this.deps.uiComponents.validateFields($(this.config.baseElement))&&(this.enableDefaultButton(!1),this._renameFlow())}},RenameFlowPopup:function(e){this._super(e)},open:function(){return this._super(),n=$.Deferred()},_renameFlow:function(){var e=this.config.parentView.computeRenameFlowData(this.bindings.newName());e?this.notify({UPDATE_FLOW:{data:e}},{actionSpinner:!0}).always(_.bind(function(e){this.resetFields(),this.bindings.newName(""),this.close(),e.status>204?(this.deps.messaging.showI18nError(e,"flows.flow.errors.updateFlow"),n.reject(e)):n.resolve(e),n=void 0},this)):(n.reject(),n=void 0)}});return s}),define("bots.package.flows/delete.flow",["module","bots.package.view/dialog","bots.i18n"],function(e,t,o){var i,n=t.extend({module:e,name:"DeleteFlowPopup"},{config:{type:"ojDialog"},bindings:{flowName:{func:ko.observable},deleteFlow:function(){this.deps.uiComponents.validateFields($(this.config.baseElement))&&(this.enableDefaultButton(!1),this._deleteFlow())}},DeleteFlowPopup:function(e){this._super(e)},open:function(){return this.bindings.flowName(this.config.flowName),this._super(),i=$.Deferred()},_deleteFlow:function(){var e=this.config.parentView.computeDeleteFlowData();e?this.notify({DELETE_FLOW:{data:e}},{actionSpinner:!0}).always(_.bind(function(e){this.resetFields(),this.close(),e.status>204?(this.deps.messaging.showI18nError(e,"flows.flow.errors.deleteFlow"),i.reject(e)):i.resolve(e),i=void 0},this)):(i.reject(),i=void 0)}});return n}),define("bots.package.flows/component.home",["module","bots.package.view/view","bots.i18n","suite.package.util/messaging"],function(e,t,o,i){var n=t.extend({module:e,name:"HomeView"},{bindings:{categories:{func:ko.observableArray,args:[]},selectCategory:function(e){this.options.selectedCategory=e,this.config.parentView.visitSubview("template",this.options)},close:function(){this.config.parentView.close()}},HomeView:function(e){this._super(e)},loadModule:function(e){return!!this._super(e)&&(this.bindings.categories(e.options.categories),void(this.options=e.options))},reloadModule:function(e){return!!this._super(e)&&void(void 0!==e.options&&(this.options=e.options))}});return n}),define("bots.package.flows/component.template",["module","bots.package.view/view","bots.i18n","suite.package.util/messaging","codemirror","js-yaml"],function(e,t,o,i,n,s){var a=t.extend({module:e,name:"ComponentTemplate"},{__static__:{END_OF_FILE:"_END_OF_FILE"},bindings:{selectedCategory:{func:ko.observable,args:[{templates:[]}]},selectedTemplate:{func:ko.observable,args:[]},selectedTemplateText:{func:ko.observable,args:[]},removeComments:{func:ko.observable,args:[!1]},states:{func:ko.observableArray,args:[]},insertAfter:{func:ko.observable,args:[]},templates:{func:ko.computed,args:[function(){return new oj.ArrayTableDataSource(this.bindings.selectedCategory().templates,{idAttribute:"id"})},this,{deferEvaluation:!0}]},selectTemplate:function(e,t){if("selection"===t.option){var n=this.bindings.selectedTemplate();if(""!==n){var s=_.findWhere(this.bindings.selectedCategory().templates,{
id:n});s?this.bindings.selectedTemplateText(s.template):i.showError(o.translate("flows.errors.noTemplateFound",n))}}},addComponentTemplate:function(e){var t="  "+this.bindings.insertAfter(),o=$("#"+this.flowEditorId);if(o.length>0){var i=o.suiteCodeMirror("instance"),n=i.getDoc(),s=this._findLineNo(n,t),a={line:s,ch:0},r=n.lineCount(),l=this.bindings.selectedTemplateText();l=s===n.lineCount()?"\n"+l:l;var d=this.bindings.removeComments()?this._removeComments(l):l+"\n";n.replaceRange(d,a);var c=n.lineCount(),u=s+(c-r);n.setSelection({line:s,ch:0},{line:u,ch:0}),i.focus()}this.config.parentView.close()},returnHome:function(){this.config.parentView.visitHome()},close:function(){this.config.parentView.close()},disableActionApply:{func:ko.observable,args:[!1]},applyCategory:function(){}},ComponentTemplate:function(e){this._super(e)},loadModule:function(e){return!!this._super(e)&&void this._init(e)},reloadModule:function(e){return!!this._super(e)&&void this._init(e)},_init:function(e){this.bindings.selectedCategory(e.options.selectedCategory),this.flowEditorId=e.options.flowEditorId,this.bindings.selectedTemplate(""),this.bindings.selectedTemplateText(""),this.bindings.states(this._getStates()),this.bindings.insertAfter([this.__static__.END_OF_FILE])},_removeComments:function(e){for(var t=e.split("\n"),o="",i=0,n=t.length;i<n;i++)0!==t[i].trim().indexOf("#")&&(o+=t[i]+"\n");return o},_findLineNo:function(e,t){if(t.trim()===this.__static__.END_OF_FILE)return e.lineCount();var o;return e.eachLine(function(e){0===e.text.indexOf(t)&&(o=e.lineNo())}),o},_getStates:function(){var e=[],t=$("#"+this.flowEditorId);if(t.length>0){var o=t.suiteCodeMirror("instance"),i=s.load(o.getDoc().getValue());if(i.hasOwnProperty("states"))for(var n in i.states)i.states.hasOwnProperty(n)&&e.push({value:n,label:n})}if(e.length>0){for(var a=0,r=e.length;a<r-1;a++)e[a].value=e[a+1].label;e[e.length-1].value=this.__static__.END_OF_FILE,e=_.sortBy(e,"label")}return e}});return a}),define("bots.package.flows/component.popup",["module","bots.package.view/subview","bots.package.flows/facade","bots.package.flows/component.home","bots.package.flows/component.template","bots.i18n","suite.package.util/messaging","bots.config"],function(e,t,o,i,n,s,a,r){var l=t.extend({module:e,name:"ComponentPopupBuilder"},{deps:{i18n:s,facade:o},bindings:{componentHome:{func:function(){return new i({isSubView:!0,baseElement:this.config.subcontentElement+"-home",contentElement:this.config.subcontentElement+"-home",baseTemplate:"bots/flows/component.home",baseTemplateElement:this.config.subcontentElement+"-home",baseTemplateData:r.templateData,parentView:this,options:this.config.options})}},componentTemplate:{func:function(){return new n({isSubView:!0,baseElement:this.config.subcontentElement+"-template",contentElement:this.config.subcontentElement+"-template",baseTemplate:"bots/flows/component.template",baseTemplateElement:this.config.subcontentElement+"-template",baseTemplateData:r.templateData,parentView:this,options:this.config.options})}}},ComponentPopupBuilder:function(e){this._super(e)},initModule:function(e){if(!this._super(e))return!1},open:function(e,t){$(this.config.baseElement).ojPopup("open",e),this.visitHome(t)},close:function(){$(this.config.baseElement).ojPopup("close")},visitHome:function(e){this.visitSubview("home",e)},visitSubview:function(e,t){this.renderSubview({subview:e,options:t,callback:function(){_.defer(function(){setTimeout(function(){$(".bots-first-focusable").focus()},500)})}})}});return l}),define("bots.package.flows/view",["module","suite.package.util/messaging","bots.package.view/view","bots.i18n","bots.config","bots.dataobject","bots.collection","codemirror","js-yaml","bots.package.defectviewer/view","suite.package.shell/shell","bots.package.flows/facade","bots.package.flows/router","bots.package.flows/dataobject","bots.package.flows/model","bots.package.flows/new.flow","bots.package.flows/rename.flow","bots.package.flows/delete.flow","bots.package.flows/component.popup","bots.package.util/yaml.metadata"],function(e,t,o,i,n,s,a,r,l,d,c,u,f,h,p,m,b,w,g,v){var y=o.extend({module:e,name:"FlowsView"},{__static__:{FLOW_TAB_CONTEXT_MENU_ITEM_IDPREFIX:"flow-tab-context-menu-item-",FLOW_TAB_LABEL_IDPREFIX:"flow-tab-label-",FLOW_TAB_IDPREFIX:"flow-tab-",FLOW_EDITOR_IDPREFIX:"flow-editor-",SELECT_COMPONENT_BUTTON_ID:"select-component-button",COMPONENT_TEMPLATE_POPUP_ID:"component-template-popup",THEME_ENUMS:{default:"default","3024-day":"3024-day","3024-night":"3024-night",abcdef:"abcdef","ambiance-mobile":"ambiance-mobile",ambiance:"ambiance","base16-dark":"base16-dark","base16-light":"base16-light",bespin:"bespin",blackboard:"blackboard",cobalt:"cobalt",colorforth:"colorforth",dracula:"dracula","duotone-dark":"duotone-dark","duotone-light":"duotone-light",eclipse:"eclipse",elegant:"elegant","erlang-dark":"erlang-dark",hopscotch:"hopscotch",icecoder:"icecoder",isotope:"isotope","lesser-dark":"lesser-dark",liquibyte:"liquibyte",material:"material",mbo:"mbo","mdn-like":"mdn-like",midnight:"midnight",monokai:"monokai",neat:"neat",neo:"neo",night:"night","panda-syntax":"panda-syntax","paraiso-dark":"paraiso-dark","paraiso-light":"paraiso-light","pastel-on-dark":"pastel-on-dark",railscasts:"railscasts",rubyblue:"rubyblue",seti:"seti",solarized:"solarized","the-matrix":"the-matrix","tomorrow-night-bright":"tomorrow-night-bright","tomorrow-night-eighties":"tomorrow-night-eighties",ttcn:"ttcn",twilight:"twilight","vibrant-ink":"vibrant-ink","xq-dark":"xq-dark","xq-light":"xq-light",yeti:"yeti",zenburn:"zenburn"}},deps:{i18n:i,facade:u,router:f},markEnqueuedDefect:void 0,bindings:{theme:{func:function(){var e=this,t=this.bindings.userPreferences().theme,o=ko.observableArray([t]);return o.subscribe(function(t){if(e.ignoreThemeChange)return void(e.ignoreThemeChange=!1);if(Array.isArray(t)&&t.length>0){var o=e.bindings.userPreferences();o.theme=t[0],e.bindings.userPreferences(o)}}),o}},themeOptions:{func:function(){var e=[];return _.each(_.omit(this.__static__.THEME_ENUMS,"default"),function(t,o){e.push({value:t,label:i.translate("flows.themeEnums."+o)})}),e=_.sortBy(e,"label"),e.unshift({value:this.__static__.THEME_ENUMS.default,label:i.translate("flows.themeEnums.default")}),e}},componentTemplatePopup:{func:function(){return new g({baseElement:"#"+this.__static__.COMPONENT_TEMPLATE_POPUP_ID,contentElement:"#"+this.__static__.COMPONENT_TEMPLATE_POPUP_ID,subcontentElement:"#"+this.__static__.COMPONENT_TEMPLATE_POPUP_ID+"-subcontent",subviewAnchor:this.__static__.COMPONENT_TEMPLATE_POPUP_ID+"-subcontent",parentView:this})}},openComponentTemplatePopup:function(){var e={categories:this.componentTemplates,flowEditorId:this.__static__.FLOW_EDITOR_IDPREFIX+this.currentFlowId,popupId:this.__static__.COMPONENT_TEMPLATE_POPUP_ID};this.bindings.componentTemplatePopup.open("#"+this.__static__.SELECT_COMPONENT_BUTTON_ID,e)},botFlows:{func:ko.observable},flows:{func:function(){var e=this,t=ko.observableArray([]);return t.subscribe(function(t){e.flowEditorReady&&_.defer(function(){e._synchFlowTabs()})}),t}},contextualFlowId:{func:ko.observable},flowTabsContextMenuItems:{func:function(){return[{id:"flow-tab-context-menu-item-rename",text:i.translate("flows.flow.tabContextMenu.rename"),disabled:ko.computed(function(){return this.bindings.flows().length>0&&this.bindings.contextualFlowId()===this.bindings.flows()[0].id()},this,{deferEvaluation:!0}),click:"onFlowTabRename",permission:null},{id:"flow-tab-context-menu-item-delete",text:i.translate("flows.flow.tabContextMenu.delete"),disabled:ko.computed(function(){return this.bindings.flows().length>0&&this.bindings.contextualFlowId()===this.bindings.flows()[0].id()},this,{deferEvaluation:!0}),click:"onFlowTabDelete",permission:null}]}},performMenuAction:function(e,t){var o=t.item[0].attributes.getNamedItem("menuId").value,i=_.findWhere(this.bindings.flowTabsContextMenuItems,{id:o});this.bindings.contextualFlowId()&&this.bindings[i.click]()},newFlowPopup:{func:function(){return new m({baseElement:this.config.createFlowPopupElement,contentElement:this.config.createFlowPopupElement,parentView:this})}},addFlowAction:function(){this.bindings.newFlowPopup.open()},renameFlowPopup:{func:function(){return new b({baseElement:this.config.renameFlowPopupElement,contentElement:this.config.renameFlowPopupElement,parentView:this})}},onFlowTabRename:function(){this._findFlow(this.bindings.contextualFlowId())&&this.bindings.renameFlowPopup.open()},deleteFlowPopup:{func:function(){return new w({baseElement:this.config.deleteFlowPopupElement,contentElement:this.config.deleteFlowPopupElement,parentView:this})}},onFlowTabDelete:function(){var e=this._findFlow(this.bindings.contextualFlowId());e&&(this.bindings.deleteFlowPopup.config.flowName=e.name(),this.bindings.deleteFlowPopup.open())},registerFlowTabsContextMenuListeners:function(){var e=this,t=$(this.config.tabsContextMenu);t.ojMenu({beforeOpen:function(t,o){var i=o.openOptions.position.of.toElement.getAttribute("id");0===i.indexOf(e.__static__.FLOW_TAB_LABEL_IDPREFIX)&&e.bindings.contextualFlowId(i.substring(e.__static__.FLOW_TAB_LABEL_IDPREFIX.length))}})},registerFlowTabsListeners:function(){var e=this,o=$(this.config.tabsElement);o.ojTabs({beforeRemove:function(o,n){if(this===o.target){var s=n.content.attr("id").substring(e.__static__.FLOW_TAB_IDPREFIX.length),a=e._findFlowIndex(s);0===a?t.showError(i.translate("flows.deleteFlowDialog.cannotDeleteMain")):a!==-1&&(e.bindings.contextualFlowId(s),e.bindings.onFlowTabDelete()),o.preventDefault()}},select:function(t,o){var i=o.toContent;e.userDoingFlowTabSelect&&(e.currentFlowId=i.attr("id").substring(e.__static__.FLOW_TAB_IDPREFIX.length),e.notify({SELECT_FLOW:{data:{id:e.currentFlowId}}},{actionSpinner:!0})),e.bindings.synchFlowTab(i)}})},synchFlowTab:function(e){var t=this;if(e){var o,i,n=$(this.config.tabsElement);if(n.ojTabs("refresh"),Array.isArray(e)){o=$(e);var s=o.attr("id").substring(this.__static__.FLOW_TAB_IDPREFIX.length);s===this.bindings.flows()[0].id()&&(this.userDoingFlowTabSelect=!1),n.ojTabs("option","selected",this.__static__.FLOW_TAB_IDPREFIX+s),s===this.bindings.flows()[this.bindings.flows().length-1].id()&&this.notify({SELECT_FLOW:{data:{id:this.currentFlowId}}},{actionSpinner:!0})}else o=e,i=o.find(".flowEditor"),i.suiteCodeMirror("focus"),i.suiteCodeMirror("refresh"),this._nuclearRefreshCM(),i.each(function(e){t._triggerCmWrapperRefresh(this)})}},computeFlowMaxWidth:function(e){var t=$("#"+this.__static__.FLOW_EDITOR_IDPREFIX+e);if(t.length>0){var o=t.suiteCodeMirror("instance");if(o){var i=o.getWrapperElement();if(i&&$(i).is(":visible")){var n=$(window).outerWidth(!0)-60+"px";return n}}}return"none"},onFlowEditorChanges:function(e){this.codeTextDirty=!0,this.cmEditor=e},onFlowEditorBlur:function(){this.flowEditorReady&&this.codeTextDirty&&this._autoSave()},debouncedAutoSave:{func:function(){return _.debounce(this._autoSave,4e3)}}},reloaded:void 0,currentFlowId:void 0,componentTemplates:[],codeTextDirty:!1,flowEditorReady:!1,flowsRequested:!1,ignoreThemeChange:!1,FlowsView:function(e){this._super(e),v.__static__.registerFoldMetadata(r)},initModule:function(e){this._super(e)&&this.listen({LOAD_FLOWS:this._flowsLoaded,CREATE_FLOW:this._flowCreated,SELECT_FLOW:this._flowSelected,LOAD_FLOW:this._flowLoaded,UPDATE_FLOW:this._flowUpdated,DELETE_FLOW:this._flowDeleted,VALIDATE_FLOW:this._flowValidated,LOAD_COMPONENT_TEMPLATES:this._componentTemplatesLoaded})},bindView:function(e){this._super(e)},renderView:function(e){this._super(e),this.bindings.componentTemplatePopup.renderView(e)},loadModule:function(e){return!!this._super(e)&&(this._requestGetFlows(),void this._loadComponentTemplates())},reloadModule:function(e){return!!this._super(e)&&(this.reloaded=!0,this._requestGetFlows(),void this._loadComponentTemplates())},buildOnRender:function(){var e=this._super();return _.extend(e,{SUB_ROUTE_DISPLAY:_.bind(function(t){var o=this;if(this.__fqclassname__.indexOf(t.subPackage)!==-1&&Array.isArray(t.extraParams)&&t.extraParams.length>0){var i=_.find(d.bindings.defects(),function(e){return e.ordinal===t.extraParams[0]});i&&_.defer(function(){o.enqueueDefect(!0,!0,i)})}e.ROUTE_DISPLAY(t)},this)})},computeRenameFlowData:function(e){var t=this._findFlow(this.bindings.contextualFlowId());if(t){var o=t.toJS();return o.name=e,_.some(o.codeLines,function(t,i){if(0===t.indexOf("name:"))return o.codeLines[i]='name: "'+e+'"',!0}),this.pendingUpdateData=o,o}},computeDeleteFlowData:function(){var e=this._findFlow(this.bindings.contextualFlowId());if(e)return{id:e.id()}},validateFlowName:function(e){return!_.some(this.bindings.flows(),function(t){return t.name()===e})},enqueueDefect:function(e,t,o,i){if(void 0===this.markEnqueuedDefect){var n=this;this.markEnqueuedDefect=_.once(_.partial(this.markCodeMirrorEditor,e,t,o,i)),setTimeout(function(){"function"==typeof n.markEnqueuedDefect&&n.markEnqueuedDefect()},n.flowEditorReady?600:2e3)}},markCodeMirrorEditor:function(e,t,o,i){if(void 0!==this.markEnqueuedDefect){var n=o;if(this.markEnqueuedDefect=void 0,void 0===i&&(i=$("#"+this.__static__.FLOW_EDITOR_IDPREFIX+this.currentFlowId)),e&&i.suiteCodeMirror("message","clear"),void 0!==n){var s=void 0!==n.line?n.line:n.mark.line;if("number"!=typeof s||s<0)return void this.warn("Invalid line number: "+s);i.suiteCodeMirror("message",{type:"error",line:s,message:n.message}),t&&_.defer(function(){var e=d.bindings._isDefectViewerOpen().length>0?($(window).height()-250)/2:$(window).height()/2,t=$(".cm-gutter-error");if(t.length>0){var o=t.offset().top-e;o>=0&&$("html, body").animate({scrollTop:o},1e3)}})}}},_nuclearRefreshCM:function(){var e=this;_.defer(function(){setTimeout(function(){e.ignoreThemeChange=!0,e.bindings.theme.valueHasMutated()},400)})},_setCurrentFlowId:function(e){this.currentFlowId=e},_triggerCmWrapperRefresh:function(e){var t=e instanceof jQuery?e:$(e),o=t.suiteCodeMirror("instance");"function"==typeof o.getWrapperElement&&$(o.getWrapperElement()).trigger("cm.refresh")},_spinnerOption:function(){return this.reloaded?{actionSpinner:!0}:{loadingSpinner:!0}},_findFlow:function(e){return e=e||this.currentFlowId,_.find(this.bindings.flows(),function(t){return t.id()===e})},_findFlowIndex:function(e){return e=e||this.currentFlowId,_.findIndex(this.bindings.flows(),function(t){return t.id()===e})},_requestGetFlows:function(){this.flowsRequested=!0,this._setCurrentFlowId(void 0),this.flowEditorReady=!1,this.notify({LOAD_FLOWS:{data:{}}},this._spinnerOption()).always(_.bind(function(){t.showI18nError(_.filter(arguments,function(e){return e.status>200}),"flows.errors.loadFlows",[ko.unwrap(n.getCurrentBot().name)])},this))},_loadComponentTemplates:function(){this.notify({LOAD_COMPONENT_TEMPLATES:{data:{}}},this._spinnerOption()).always(_.bind(function(){t.showI18nError(_.filter(arguments,function(e){return e.status>200}),"flows.errors.loadComponentTemplates")},this))},_synchFlowTabs:function(){var e,t=this,o=$(this.config.tabsElement),i=o.find(".flowEditor");o.ojTabs("refresh"),this.userDoingFlowTabSelect=!1,i.each(function(i){o.ojTabs("option","selected",i),e=t.bindings.flows()[i].id(),r.commands.foldMetadata($(this).suiteCodeMirror("instance"))}),i.suiteCodeMirror("refresh"),this._nuclearRefreshCM(),this.userDoingFlowTabSelect=!0,t.currentFlowId!==e&&o.ojTabs("option","selected",t.currentFlowId)},_flowsLoaded:function(e){if(this.flowsRequested){this.flowsRequested=!1;var t=this,o=this.currentFlowId,i=[];if(!e||!e.data)return void this.bindings.flows([]);h.BotFlowsDO.__static__.fromJS(e.data,this.bindings.botFlows),_.each(this.bindings.botFlows().items(),function(e){!o&&e.isMain()&&(o=e.id()),i.push(e)}),o||i.length>0&&(o=i[0].id()),this._setCurrentFlowId(o),this.bindings.flows(i),_.defer(function(){t._synchFlowTabs()}),this.currentFlowId&&this.notify({SELECT_FLOW:{data:{id:this.currentFlowId}}},this._spinnerOption())}},_flowCreated:function(e){if(e&&e.data){var t=new h.FlowDetailedDO(e.data);this.currentFlowId=t.id(),this.bindings.flows.push(t),this._prepareFlowAutoSave()}},_flowSelected:function(e){var o=e.id,i=this._findFlow(o);i&&(this._setCurrentFlowId(o),this.notify({LOAD_FLOW:{data:{id:this.currentFlowId}}},this._spinnerOption()).always(_.bind(function(){t.showI18nError(_.filter(arguments,function(e){return e.status>200}),"flows.flow.errors.loadFlow",[this.currentFlowId])},this)))},_prepareFlowAutoSave:function(e){var t=this;_.defer(function(){t.userDoingFlowTabSelect=!1,$(t.config.tabsElement).ojTabs("option","selected",t.__static__.FLOW_TAB_IDPREFIX+t.currentFlowId),t.userDoingFlowTabSelect=!0,t.flowEditorReady=!0,"function"==typeof t.markEnqueuedDefect&&t.markEnqueuedDefect()})},_flowLoaded:function(e){if(e&&e.data){var t=e.id,o=this._findFlowIndex(t);if(o!==-1){var i=this.bindings.flows()[o];this.bindings.flows()[o].reloadFromJS(e.data),this._prepareFlowAutoSave(i)}}},_flowUpdated:function(e){if(e.status<=204){this.codeTextDirty=!1;var o=e.id,n=this._findFlow(o);this.pendingUpdateData&&(this.ignoreRenameUpdate=!0,n.fromJS(this.pendingUpdateData),this.pendingUpdateData=void 0,t.showConfirmation(i.translate("flows.flow.renamed",n.name())))}},_flowDeleted:function(e){if(e.status<=204){var o=e.id,n=this._findFlowIndex(o);if(n!==-1){var s=this.bindings.flows()[n].name();this.bindings.flows.splice(n,1),t.showConfirmation(i.translate("flows.flow.deleted",s))}}},_flowValidated:function(e){this._findFlow(this.currentFlowId);if(e.data&&Array.isArray(e.data.diagnostics)&&e.data.diagnostics.length>0){var t=_.extend({},e.data.diagnostics[0],{line:e.data.diagnostics[0].line-1});this.enqueueDefect(!0,!1,t)}else this.enqueueDefect(!0)},_componentTemplatesLoaded:function(e){if(e&&e.data){var t=_.map(e.data,function(e){return e.displayName=i.translate("flows.builtInComponents."+e.id.replace(".","-")),e.templates=_.map(e.templates,function(e){return e.displayName=i.translate("flows.builtInComponents."+e.id.replace(".","-")),e}),e.templates=_.sortBy(e.templates,"displayName"),e});t=_.sortBy(t,"displayName"),this.componentTemplates=t}},_validateYaml:function(e,t){if(e){t.suiteCodeMirror("message","clear");try{l.safeLoad(e.codeText())}catch(e){e.mark&&this.enqueueDefect(!1,!1,e,t)}}},_autoSave:function(e){if(this.codeTextDirty)if(this.ignoreRenameUpdate)this.codeTextDirty=!1,this.ignoreRenameUpdate=void 0;else{e=e||this.currentFlowId;var o=this._findFlow(e);if(o){o.codeText(this.cmEditor.getValue()),this._validateYaml(o,$(this.cmEditor.getTextArea()));var i=o.toJS();this.notify({UPDATE_FLOW:{data:i}},{actionSpinner:!0,autoSave:!0}).always(function(){t.showI18nError(_.filter(arguments,function(e){return e.status>204}),"flows.flow.errors.updateFlow",[i.name])})}}}});return new y({isSubView:!0,baseElement:"#bot-details-tab-flows",contentElement:"#bot-details-tab-flows",baseTemplateData:n.templateData,baseTemplate:"bots/flows/body",baseTemplateElement:"#bot-details-tab-flows",tabsContextMenu:"#flow-tabs-context-menu",tabsElement:"#flow-tabs",createFlowPopupElement:"#flows-create-dialog",renameFlowPopupElement:"#flows-rename-dialog",deleteFlowPopupElement:"#flows-delete-dialog"})}),function(){define("bots.package.flows/package.main",["ojs/ojbutton","ojs/ojnavigationlist","ojs/ojswitch","codemirror","codemirror.placeholder","codemirror.javascript","codemirror.markdown","codemirror.xml","codemirror.yaml","codemirror.foldgutter"]),require(["bots.templates/flows","bots.package.flows/facade","bots.package.flows/model","bots.package.flows/view","bots.package.flows/new.flow","bots.package.flows/rename.flow","bots.package.flows/delete.flow","bots.package.flows/component.popup"])}(),define("bots.package.flows",["bots.package.flows/package.main"],function(e){return e});